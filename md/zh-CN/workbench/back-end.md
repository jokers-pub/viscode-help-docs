## 了解服务端

本章将着重阐述服务端项目的功能，以及其具备的便捷开发能力。

JOKER 平台秉持前后端分离的开发模式，赋予开发人员自主选择的灵活性，开发人员可以依据自身专长与项目需求，专注投入到前端或服务端项目的开发工作中。本文将把重点放在服务端部分，深入且详细地对其功能展开讲解，助力读者全面了解服务端在 JOKER 平台中的开发应用。

### 概述

服务端项目肩负着处理数据的重任，是互联网应用里不可或缺的数据处理层。在整个应用架构中，它犹如幕后的“数据管家”，高效地管理和处理着大量数据，为前端应用提供稳定的数据支持。

在服务端开发领域，JOKER 智能开发平台为开发者们打开了灵活开发的大门。通过这个平台，开发者能够以可视化的方式，轻松完成所有服务端资产的开发工作。比如在数据库表结构设计方面，开发者可以像搭建积木一样，直观地规划和构建数据库表的结构，明确字段之间的关系，确保数据存储的高效性和合理性；在控制器（API）设计时，能够便捷地定义各种接口，规范数据的输入输出，让前端与服务端的数据交互更加顺畅；在缓存处理设计上，也能可视化地进行设置，优化数据的读取和存储速度，提升应用的整体性能。

![](/workbench/back-end.png)

### 功能要素

一个完整的服务端项目（应用）由多种类型的文件协同构成，这些文件从类型上主要涵盖以下几类：

-   **数据模型**：借助可视化操作界面，开发者能够全方位完成项目的数据库表结构设计。该功能支持高度灵活的自主设计，无论是常见的表关联、主键设定，还是联合索引配置等，都能轻松实现，充分满足复杂的数据管理需求。
-   **控制器**：作为服务端与外部交互的关键桥梁，主要负责对外提供接口（API）的声明以及相关逻辑处理。通过它，我们可以灵活配置多样化的 API 接口。平台底层依托`@joker.server/core`，进一步强化了控制能力，让开发者能够轻松设计接口鉴权机制，进行数据安全检查等功能，保障接口使用的安全性与可靠性。
-   **缓存**：缓存机制在服务端项目中扮演着性能优化的重要角色。它能够针对热点数据进行高效的读写操作，避免对数据库底层的重复运算与频繁访问，从而显著提升系统的响应速度，有效减轻系统整体的性能负担，确保服务端在高并发等场景下也能稳定运行。
-   **配置文件**：用于集中管理当前项目中的各类公共配置。这其中包括公共样式设定，明确组件库类型项目中开放哪些组件，确定组件库、方法集类型项目中开放哪些方法集，进行路由管理，设置全局变量与全局方法，以及处理 NPM 引用等。通过统一管理这些配置，可确保项目开发与运行的规范性和高效性。
-   **环境变量**：该文件专门负责声明和管理不同环境下的变量。通过巧妙设置不同的环境变量，能够实现项目在开发、测试、生产等不同环境中呈现差异化的运行效果，满足各阶段对项目的特定需求。

### 数据模型

在控制台左侧菜单中，点击“数据库”选项，即可打开数据模型设计面板。在此面板上，数据库表结构以直观的形式呈现，方便我们对其进行管理与维护。

![数据模型设计面板截图](/workbench/back-end2.png)

令人欣喜的是，平台在表关系配置方面极为直观便捷。它能够依据类型匹配，自动且完整地完成关系绑定。不仅如此，平台具备完善的代码检查能力，能迅速帮我们分析出表设计过程中存在的问题。

![代码检查相关截图](/workbench/back-end3.png)

> **特别说明**：数据库底层运用“prisma”的 **pgsql** 方式实施数据库管理，不仅支持数据表结构同步，还能实现自动化数据迁移，大大提升了数据库管理的效率与便利性。

### 控制器

控制器文件在服务端开发中扮演着关键角色，它助力我们完成接口声明，并且能以可视化的方式实现 API 的内部处理。在此过程中，你既可以选择在控制器中直接编写业务逻辑，也能够创建方法集，对业务接口进行分层管理，使代码结构更加清晰，便于维护与扩展。

![控制器相关截图](/workbench/back-end4.png)

在控制器的操作方面，平台赋予了开发者极大的灵活性。不仅允许我们自由配置请求类型，还能一键开启 JWT 认证，为接口提供安全可靠的身份验证机制。此外，平台还提供了可视化的数据库操作模式，无论是单表查询、多表关联查询，还是分组查询、聚合统计查询等常见的数据库操作，都能通过可视化操作界面快速完成，大大提升了开发效率，让开发过程变得更加便捷高效。

![数据库操作可视化截图](/workbench/back-end5.png)

### 缓存

缓存文件在服务端性能优化中发挥着关键作用，它能够帮助我们对热点数据进行缓存处理。通过缓存热点数据，有效避免了频繁访问数据库，从而减轻数据库服务压力，显著提升服务器性能，同时也加快了数据访问速度，极大地提高了用户访问效率。

![缓存相关截图](/workbench/back-end6.png)

目前，平台提供了丰富且实用的三种维度缓存结构数据，并且还在持续拓展新的缓存结构（内容不断新增中）：

-   **单项存储**：主要提供简单而直接的值操作，包括值的获取、设置以及删除。通过这些基础操作，能快速处理单个数据的缓存需求，适用于对单个数据频繁读写场景下的缓存管理。
-   **数组存储**：对外提供了一系列围绕数组特性的缓存操作。不仅可以获取缓存长度，了解当前缓存中数据项的数量；还能进行缓存插入，动态添加新的数据到缓存数组中；当需要清理缓存数组时，可使用缓存清空功能；若要获取特定区间范围内的数据，缓存列表（区间范围）操作可满足需求；并且，能够根据索引精准获取缓存中的数据，满足对数组型缓存数据多样化的访问需求。
-   **对象存储**：提供了基于键值对的灵活缓存操作。可以根据 Key 获取缓存，支持批量获取多个 Key 对应的缓存数据，大大提高了数据获取效率；在设置缓存时同样支持批量操作，方便一次性更新多个缓存数据；还能检查指定 Key 的缓存是否存在，便于在操作前确认数据状态；当需要清理缓存时，可执行删除缓存操作；此外，还能获取所有缓存 KEY，方便对缓存数据进行全面管理与维护，适用于以对象形式组织和管理缓存数据的复杂业务场景 。

### 配置文件

每个仓库都存在一个`项目配置`文件，我们可以通过该文件实现对项目公共数据的配置和管理。

![](/workbench/back-end7.png)

该文件具备以下能力（根据不同仓库分类会有差异）：

#### NPM 包管理

可于此处对当前项目的底层依赖包予以维护，借助安装依赖包来达成对第三方功能的集成，且能在项目里运用包内的相关功能。

![](/workbench/back-end8.png)

> 与`组件方法市场`不同的是，这里提供的是更为底层的类库引用，而组件方法市场是一种打包成型的可视化资产的扩展引用。

#### 全局变量

平台允许我们创建全局变量。

![](/workbench/back-end9.png)

### 环境变量

平台提供了完整的环境变量的维护功能。

![](/workbench/back-end10.png)

平台允许我们在其内部创建多套环境，也可以自定义环境变量，声明的环境变量可以在通过`process.env`去调用。

![](/workbench/back-end11.png)
